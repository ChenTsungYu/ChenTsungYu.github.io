<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>[Terraform] Terraform入門(1) - Tom&#039;s Blog</title><link rel="manifest" href="../../../../../../manifest.json"><meta name="application-name" content="Tom&#039;s Blog"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Tom&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="鼠年全馬鐵人挑戰 - WEEK 08    前言因目前實習公司代理許多雲服務，有使用Terraform撰寫腳本來管理雲平台，藉此機會筆記一下學習Terraform這項工具。本篇會紀錄如何實際撰寫Terraform腳本來操作AWS S3、IAM這兩項服務。"><meta property="og:type" content="blog"><meta property="og:title" content="[Terraform] Terraform入門(1)"><meta property="og:url" content="https://github.com/ChenTsungYu/2020/04/02/DevOps/Terraform/[DevOps]%20Terraform%E5%85%A5%E9%96%80/"><meta property="og:site_name" content="Tom&#039;s Blog"><meta property="og:description" content="鼠年全馬鐵人挑戰 - WEEK 08    前言因目前實習公司代理許多雲服務，有使用Terraform撰寫腳本來管理雲平台，藉此機會筆記一下學習Terraform這項工具。本篇會紀錄如何實際撰寫Terraform腳本來操作AWS S3、IAM這兩項服務。"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://i.imgur.com/YvU9Gc6.png"><meta property="og:image" content="https://i.imgur.com/GjwMRMh.png"><meta property="og:image" content="https://i.imgur.com/foPxFOr.png"><meta property="og:image" content="https://i.imgur.com/2TawSA9.png"><meta property="og:image" content="https://i.imgur.com/VMlNyM0.png"><meta property="og:image" content="https://i.imgur.com/ulyBx4V.png"><meta property="og:image" content="https://i.imgur.com/G9lZodz.png"><meta property="og:image" content="https://i.imgur.com/hGalTTq.png"><meta property="og:image" content="https://i.imgur.com/IfUQbgf.png"><meta property="og:image" content="https://i.imgur.com/LsqXfbB.png"><meta property="og:image" content="https://i.imgur.com/g2SyYqH.png"><meta property="og:image" content="https://i.imgur.com/F8bv84x.png"><meta property="og:image" content="https://i.imgur.com/LdredzD.png"><meta property="og:image" content="https://i.imgur.com/mWQurQU.png"><meta property="og:image" content="https://i.imgur.com/upE1g3l.png"><meta property="og:image" content="https://i.imgur.com/RD3DQDZ.png"><meta property="og:image" content="https://i.imgur.com/oaUuKMP.png"><meta property="og:image" content="https://i.imgur.com/69YRDlT.png"><meta property="og:image" content="https://i.imgur.com/s22KCDD.png"><meta property="og:image" content="https://i.imgur.com/reELhuw.png"><meta property="og:image" content="https://i.imgur.com/SkqPeBp.png"><meta property="og:image" content="https://i.imgur.com/akev1CY.png"><meta property="og:image" content="https://i.imgur.com/pYtq42f.png"><meta property="article:published_time" content="2020-04-02T00:00:10.000Z"><meta property="article:modified_time" content="2021-09-28T09:36:25.940Z"><meta property="article:author" content="Tsung Yu Chen"><meta property="article:tag" content="w3HexSchool"><meta property="article:tag" content="AWS"><meta property="article:tag" content="DevOps"><meta property="article:tag" content="Terraform"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://i.imgur.com/YvU9Gc6.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://github.com/ChenTsungYu/2020/04/02/DevOps/Terraform/[DevOps]%20Terraform%E5%85%A5%E9%96%80/"},"headline":"Tom's Blog","image":["https://i.imgur.com/YvU9Gc6.png","https://i.imgur.com/GjwMRMh.png","https://i.imgur.com/foPxFOr.png","https://i.imgur.com/2TawSA9.png","https://i.imgur.com/VMlNyM0.png","https://i.imgur.com/ulyBx4V.png","https://i.imgur.com/G9lZodz.png","https://i.imgur.com/hGalTTq.png","https://i.imgur.com/IfUQbgf.png","https://i.imgur.com/LsqXfbB.png","https://i.imgur.com/g2SyYqH.png","https://i.imgur.com/F8bv84x.png","https://i.imgur.com/LdredzD.png","https://i.imgur.com/mWQurQU.png","https://i.imgur.com/upE1g3l.png","https://i.imgur.com/RD3DQDZ.png","https://i.imgur.com/oaUuKMP.png","https://i.imgur.com/69YRDlT.png","https://i.imgur.com/s22KCDD.png","https://i.imgur.com/reELhuw.png","https://i.imgur.com/SkqPeBp.png","https://i.imgur.com/akev1CY.png","https://i.imgur.com/pYtq42f.png"],"datePublished":"2020-04-02T00:00:10.000Z","dateModified":"2021-09-28T09:36:25.940Z","author":{"@type":"Person","name":"Tsung Yu Chen"},"description":"鼠年全馬鐵人挑戰 - WEEK 08    前言因目前實習公司代理許多雲服務，有使用Terraform撰寫腳本來管理雲平台，藉此機會筆記一下學習Terraform這項工具。本篇會紀錄如何實際撰寫Terraform腳本來操作AWS S3、IAM這兩項服務。"}</script><link rel="canonical" href="https://github.com/ChenTsungYu/2020/04/02/DevOps/Terraform/[DevOps]%20Terraform%E5%85%A5%E9%96%80/"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="../../../../../../css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.2"></head><body class="is-2-column"><script type="text/javascript" src="/js/imaegoo/night.js"></script><canvas id="universe"></canvas><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="../../../../../../index.html"><img class="logo-img" src="../../../../../../img/dragon_blue.png" alt="Tom&#039;s Blog" height="28"><img class="logo-img-dark" src="../../../../../../img/dragon_red.png" alt="Tom&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="../../../../../../index.html">Home</a><a class="navbar-item" href="../../../../../../archives">Archives</a><a class="navbar-item" href="../../../../../../categories">Categories</a><a class="navbar-item" href="../../../../../../tags">Tags</a><a class="navbar-item" href="../../../../../../about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ChenTsungYu"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item night" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-7-tablet is-8-desktop is-10-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2020-04-02T00:00:10.000Z" title="4/2/2020, 8:00:10 AM">2020/04/02</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-09-28T09:36:25.940Z" title="9/28/2021, 5:36:25 PM">2021/09/28</time></span><span class="level-item"><a class="link-muted" href="../../../../../../categories/DevOps/">DevOps</a></span><span class="level-item">16 minutes read (About 2401 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">[Terraform] Terraform入門(1)</h1><div class="content"><blockquote>
<p>鼠年全馬鐵人挑戰 - WEEK 08</p>
</blockquote>
<p><img src="https://i.imgur.com/YvU9Gc6.png"></p>
<!-- toc -->
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>因目前實習公司代理許多雲服務，有使用Terraform撰寫腳本來管理雲平台，藉此機會筆記一下學習Terraform這項工具。本篇會紀錄如何實際撰寫Terraform腳本來操作AWS S3、IAM這兩項服務。</p>
<span id="more"></span>
<h1 id="什麼是Terraform？"><a href="#什麼是Terraform？" class="headerlink" title="什麼是Terraform？"></a>什麼是Terraform？</h1><p>Terraform是由HashiCorp這家公司所開發，是一個基礎架構即程式碼(Infrastructure as Code;簡稱IaC)的開源工具，關於IaC架構的細節可參考<a target="_blank" rel="noopener" href="https://www.ithome.com.tw/tech/106167">這篇</a>，而且它支持多種雲環境，還可以進行版本控制。<br>可以想像一種情況，如果今天有多個雲要進行管理，可能架構會隨時需要調整，或是要配置資料庫、網路安全等設定時Terraform變成是很好的工具去管理這些雲端的基礎架構。以AWS為例，有了Terraform後，我們便不再需要透過手動操作滑鼠點擊console介面，只要撰寫好 Terraform 腳本，一鍵就能完成想要做的事情，透過程式碼去管理擁有的雲端資源。<br>簡單歸納一下Terraform的優點及特色</p>
<ul>
<li>針對擁有的雲端服務做版本控管</li>
<li>自動化測試雲端架構</li>
<li>容易閱讀，一起開發的人可閱讀腳本理解目前使用的雲服務相關設定</li>
<li>在不同的環境下(如: 開發、測試、實際上線)，雲服務的配置都會相同</li>
<li>Terraform的檔案副檔名是<code>*.tf</code></li>
<li>用<a target="_blank" rel="noopener" href="http://lifuzu.com/blog/2019/02/10/using-terraform-external-data-source/">HCL</a>語言撰寫</li>
<li>跨平台(支援哪些平台可看<a target="_blank" rel="noopener" href="https://www.terraform.io/docs/providers/">官方文件</a>)</li>
</ul>
<h1 id="Hands-On-Lab"><a href="#Hands-On-Lab" class="headerlink" title="Hands On Lab"></a>Hands On Lab</h1><h2 id="安裝"><a href="#安裝" class="headerlink" title="安裝"></a>安裝</h2><p><a target="_blank" rel="noopener" href="https://learn.hashicorp.com/terraform/getting-started/install.html">官方載點</a><br>如果是Mac的話可以使用Homebrew</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">brew install terraform<br></code></pre></td></tr></table></figure>
<p>當然也可以手動下載壓縮檔，解壓縮到<code>/usr/bin</code>、<code>/usr/local/bin</code> 目錄，解壓縮得到編譯好的執行檔。</p>
<h2 id="查看版本"><a href="#查看版本" class="headerlink" title="查看版本"></a>查看版本</h2><p>檢查是否可執行terraform，開啟終端機，輸入<code>terraform -version</code>，會顯示當前terraform版本訊息<br><img src="https://i.imgur.com/GjwMRMh.png"></p>
<h2 id="初始化Provider"><a href="#初始化Provider" class="headerlink" title="初始化Provider"></a>初始化Provider</h2><p>先來個範例吧！<br>在專案資料夾建立一個名為<code>main.tf</code>的檔案</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Configure the AWS Provider</span><br>provider <span class="hljs-string">&quot;aws&quot;</span> &#123;<br>  region = <span class="hljs-string">&quot;us-east-2&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>下指令進行初始化</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">terraform init<br></code></pre></td></tr></table></figure>
<p>terraform 會根據在當前的目錄下產生一些本地端設定，並根據上面的設定下載相對應的二進位檔，放到<code>.terraform</code>目錄中。<br>上述的程式碼中，<code>provider</code>用於決定對哪一個平台操作 <code>region</code>是AWS需要的屬性，表示地區。<br><img src="https://i.imgur.com/foPxFOr.png"></p>
<h2 id="配置Provider"><a href="#配置Provider" class="headerlink" title="配置Provider"></a>配置Provider</h2><p>將終端機出現的<code>version = &quot;~&gt; 2.55&quot;</code> 這段資訊加入<code>main.tf</code>內。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Configure the AWS Provider</span><br>provider <span class="hljs-string">&quot;aws&quot;</span> &#123;<br>  region = <span class="hljs-string">&quot;us-east-2&quot;</span><br>  version = <span class="hljs-string">&quot;~&gt; 2.55&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="查看當前目錄結構"><a href="#查看當前目錄結構" class="headerlink" title="查看當前目錄結構"></a>查看當前目錄結構</h2><p><img src="https://i.imgur.com/2TawSA9.png"></p>
<h2 id="下載並匯出-Access-Key"><a href="#下載並匯出-Access-Key" class="headerlink" title="下載並匯出 Access Key"></a>下載並匯出 Access Key</h2><p>開啟終端機，輸入下方指令，並替換成自從AWS download下來的Access Key</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> AWS_ACCESS_KEY_ID=Your Access Key<br><span class="hljs-built_in">export</span> AWS_SECRET_ACCESS_KEY=Your SECRET ACCESS Key<br></code></pre></td></tr></table></figure>
<h2 id="建立S3"><a href="#建立S3" class="headerlink" title="建立S3"></a>建立S3</h2><h3 id="配置resource"><a href="#配置resource" class="headerlink" title="配置resource"></a>配置resource</h3><p><code>resource</code>是表示決定用指定雲平台中的哪個服務(資源)，採類似JSON的結構，結構大概會是</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">resource 雲端服務(服務)名稱 自定資源名稱 &#123;<br>  屬性 = 值<br>&#125;<br></code></pre></td></tr></table></figure>
<p>以AWS S3作為範例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># plan - excute</span><br>resource <span class="hljs-string">&quot;aws_s3_bucket&quot;</span> <span class="hljs-string">&quot;my_s3_bucket&quot;</span> &#123;<br>    bucket = <span class="hljs-string">&quot;my-s3-bucket-terraform-01&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>上述程式碼表示以aws_s3_bucket為雲端資源(AWS有S3這項儲存靜態資源的服務)，並自定義一個<code>my_s3_bucket</code>名稱</p>
<h3 id="查看Terraform異動"><a href="#查看Terraform異動" class="headerlink" title="查看Terraform異動"></a>查看Terraform異動</h3><p>在實際執行之前觀察 Terraform 將做哪些哪些改變，這是為了防止我們修改到我們不應該修改的東西，或是有不是我們預期的結果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">terraform plan<br></code></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/VMlNyM0.png"></p>
<h3 id="執行-x2F-創建"><a href="#執行-x2F-創建" class="headerlink" title="執行&#x2F;創建"></a>執行&#x2F;創建</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">terraform apply<br></code></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/ulyBx4V.png"><br>這裡 Terraform 一樣會輸出相關的資訊內容，告訴你會有哪些改變，並讓你輸入去確認是否真的要執行，只要輸入 yes，就會實際開啟S3服務了。<br><img src="https://i.imgur.com/G9lZodz.png"><br>建立成功！</p>
<p>成功後回到S3 管理介面就會看到剛剛建立好的bucket囉！<br><img src="https://i.imgur.com/hGalTTq.png"></p>
<h3 id="查看狀態-state"><a href="#查看狀態-state" class="headerlink" title="查看狀態(state)"></a>查看狀態(state)</h3><p>terraform在執行完後，會在當前目錄下產生一個<code>terraform.tfstate</code>檔，此檔案包含了透過terraform 產生出來resource的詳細資訊，而terraform依據這個檔案來追蹤及維護resource。<br>輸入下方指令可秀出當前resource狀態的相關資訊</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">terraform show<br></code></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/IfUQbgf.png"></p>
<h3 id="異動"><a href="#異動" class="headerlink" title="異動"></a>異動</h3><p>假設今天我們把<code>bucket = &quot;my-s3-bucket-terraform-01&quot;</code>改成<code>bucket = &quot;my-s3-bucket-terraform-02&quot;</code>並執行<code>terraform apply</code>，會看到如下圖所示的異動資訊<br><img src="https://i.imgur.com/LsqXfbB.png"><br>回到S3管理介面會看到名稱已經做更動<br><img src="https://i.imgur.com/g2SyYqH.png"></p>
<blockquote>
<p>因為<code>terraform.tfstate</code>保留所有resource的狀態，執行terraform命令時，這個檔案必須要存在，確保 terraform可以正確的監聽resource的狀況。</p>
</blockquote>
<p>另外，透過<code>terraform plan</code>指令，可以讓你在實際執行之前觀察Terraform將做哪些哪些改變</p>
<h3 id="啟動Versioning"><a href="#啟動Versioning" class="headerlink" title="啟動Versioning"></a>啟動Versioning</h3><p>S3有個<a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/Versioning.html">Versioning的功能</a>，現在我們要透過撰寫<code>.tf</code>黨的方式來開啟這個功能，於<code>resource</code>內添加<code>versioning &#123;enabled = true&#125;</code>這段程式碼</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">resource <span class="hljs-string">&quot;aws_s3_bucket&quot;</span> <span class="hljs-string">&quot;my_s3_bucket&quot;</span> &#123;<br>    bucket = <span class="hljs-string">&quot;my-s3-bucket-terraform-02&quot;</span><br>    versioning &#123;<br>        enabled = <span class="hljs-literal">true</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>添加完畢之後執行<code>terraform apply</code>，terraform會自動幫我們變更S3的設定，執行後會看到下方這段訊息:<br><img src="https://i.imgur.com/F8bv84x.png"><br>表示versioning功能已被開啟，接著回到aws S3的console介面點選<code>my-s3-bucket-terraform-02</code>，找到<code>Properties</code><br><img src="https://i.imgur.com/LdredzD.png"><br>上圖可檢視此功能成功被開啟！</p>
<h3 id="刪除"><a href="#刪除" class="headerlink" title="刪除"></a>刪除</h3><p>執行<code>terraform destroy</code>就可以清除所有的資源，會要你輸入<code>yes</code>做為確認。</p>
<h2 id="terraform-console"><a href="#terraform-console" class="headerlink" title="terraform console"></a>terraform console</h2><p>terraform也提供console的方式來遠端操作</p>
<h3 id="實作"><a href="#實作" class="headerlink" title="實作"></a>實作</h3><p>執行下方指令進入console</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">terraform console<br></code></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/mWQurQU.png"><br>如果要查看剛剛建立的S3 bucket，依照resource中的<code>type.name</code>的方式輸入指令，如:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">aws_s3_bucket.my_s3_bucket<br></code></pre></td></tr></table></figure>
<p>表示從aws_s3_bucket這個resource中選擇剛剛建立的my_s3_bucket<br><img src="https://i.imgur.com/upE1g3l.png"><br>執行指令後會秀出該Bucket內含的相關資訊。<br>當然我們也可以往下找更詳細的資訊，如剛剛新增的<code>versioning</code>指令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">aws_s3_bucket.my_s3_bucket.versioning<br></code></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/RD3DQDZ.png"><br>回傳值為一個<strong>list</strong>資料結構的資訊，所以可以近一步取得list內的物件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">aws_s3_bucket.my_s3_bucket.versioning[0].enabled<br></code></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/oaUuKMP.png"></p>
<h3 id="退出console"><a href="#退出console" class="headerlink" title="退出console"></a>退出console</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure>
<h2 id="Output-查看輸出訊息"><a href="#Output-查看輸出訊息" class="headerlink" title="Output 查看輸出訊息"></a>Output 查看輸出訊息</h2><p>除了利用console查看<code>.tf</code>配置的訊息外，也可以撰寫<code>output</code>語法來輸出我們想要的訊息，例如印出剛剛在console內看到的訊息，可以把<code>aws_s3_bucket.my_s3_bucket.versioning[0].enabled</code>放入<code>output</code>中，如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">output <span class="hljs-string">&quot;my_s3_bucket_versioning&quot;</span> &#123;<br>  value = aws_s3_bucket.my_s3_bucket.versioning[0].enabled<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>my_s3_bucket_versioning</code>為自己定義的名稱，接著執行<code>terraform apply -refresh=false</code>查看訊息<br><img src="https://i.imgur.com/69YRDlT.png"><br>或是可以印出完整的訊息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">output <span class="hljs-string">&quot;my_s3_bucket_detail&quot;</span> &#123;<br>  value = aws_s3_bucket.my_s3_bucket<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="操作IAM"><a href="#操作IAM" class="headerlink" title="操作IAM"></a>操作IAM</h2><p>接著用terraform腳本來建立AWS IAM User</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># IAM User</span><br>resource <span class="hljs-string">&quot;aws_iam_user&quot;</span> <span class="hljs-string">&quot;my_iam_user&quot;</span> &#123;<br>    name = <span class="hljs-string">&quot;my_iam_user001&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>在終端機輸入指令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">terraform plan -out iam.tfplan<br></code></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/s22KCDD.png"><br>畫面會提示輸入<code>terraform apply &quot;iam.tfplan&quot;</code>的指令<br><img src="https://i.imgur.com/reELhuw.png"><br>印出上圖訊息表示成功建立IAM User<br><img src="https://i.imgur.com/SkqPeBp.png"><br>如上圖，進入IAM User Console介面就會看見剛剛建立好的User哦！<br>當然我們也可以印出output來做檢查</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">output <span class="hljs-string">&quot;my_iam_user_detail&quot;</span> &#123;<br>  value = aws_iam_user.my_iam_user<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/akev1CY.png"></p>
<h3 id="更新IAM-User-name"><a href="#更新IAM-User-name" class="headerlink" title="更新IAM User name"></a>更新IAM User name</h3><p>假設要更改User名<code>my_iam_user001</code>為<code>my_iam_user001_update</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># IAM User</span><br>resource <span class="hljs-string">&quot;aws_iam_user&quot;</span> <span class="hljs-string">&quot;my_iam_user&quot;</span> &#123;<br>    name = <span class="hljs-string">&quot;my_iam_user001_update&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>更改完畢後，輸入下方指令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">terraform apply -target=aws_iam_user.my_iam_user<br></code></pre></td></tr></table></figure>
<h3 id="建立多個IAM-User"><a href="#建立多個IAM-User" class="headerlink" title="建立多個IAM User"></a>建立多個IAM User</h3><p>本篇只有先記錄最基礎的用法，更多相關用法可參考<a target="_blank" rel="noopener" href="https://www.terraform.io/docs/providers/aws/r/iam_user.html">官方文件</a>。假設今天要一次建立兩個User，做法是給予IAM User這個Resource次數(count)，並透過物件的方式assign，如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">resource <span class="hljs-string">&quot;aws_iam_user&quot;</span> <span class="hljs-string">&quot;my_iam_user&quot;</span> &#123;<br>    count = 2<br>    name = <span class="hljs-string">&quot;my_iam_user_<span class="hljs-variable">$&#123;count.index&#125;</span>&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>其中index編號是從0開始，執行<code>terraform apply</code>後打開console介面會看到新建立的兩個User，分別為<code>my_iam_user_0</code>、<code>my_iam_user_1</code><br><img src="https://i.imgur.com/pYtq42f.png"></p>
<h2 id="補充一些較常用的指令"><a href="#補充一些較常用的指令" class="headerlink" title="補充一些較常用的指令"></a>補充一些較常用的指令</h2><ul>
<li><code>terraform fmt</code>： 將指令進行統一格式，改善因多人共同開發，各自風格差異過大的問題。</li>
<li><code>terraform graph</code>： 圖形化所有資源的相異性。</li>
<li><code>terraform import</code> : 導入目前已經在雲端上手動建立資源到Terraform中。</li>
<li><code>terraform validate</code>： 用於驗證是否存在語法錯誤。</li>
</ul>
<p>以上透過AWS兩個服務範例來實作Terraform腳本，倘若有疏漏或錯誤之處，可在下方留言讓我知道！</p>
<h1 id="參閱"><a href="#參閱" class="headerlink" title="參閱"></a>參閱</h1><p><a target="_blank" rel="noopener" href="https://godleon.github.io/blog/DevOps/terraform-getting-started/">Terraform 入門學習筆記</a></p>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="../../../../../../tags/w3HexSchool/">w3HexSchool</a><a class="link-muted mr-2" rel="tag" href="../../../../../../tags/AWS/">AWS</a><a class="link-muted mr-2" rel="tag" href="../../../../../../tags/DevOps/">DevOps</a><a class="link-muted mr-2" rel="tag" href="../../../../../../tags/Terraform/">Terraform</a></div><!--!--></article></div><!--!--><div class="card"><nav class="post-navigation mt-4 level is-mobile card-content"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="../../../../03/DevOps/Terraform/%5BDevOps%5D%20Terraform%E5%85%A5%E9%96%80(2)%20-%20%E8%AE%8A%E6%95%B8/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">[Terraform] Terraform入門(2) - 變數</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="../../../../../03/25/aws/%5BAWS%5D%20%E7%94%A8SSH%E9%80%A3%E6%8E%A5EC2/"><span class="level-item">[AWS] 用SSH連接EC2</span><i class="level-item fas fa-chevron-right"></i></a></div></nav></div><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: "de3f52e44695dace5d01e3d3d1540fdd",
            repo: "ChenTsungYu.github.io",
            owner: "ChenTsungYu",
            clientID: "7913190f1a943b88e276",
            clientSecret: "8c54a86c8fe06b650efe932eb53bc421ddf84773",
            admin: ["ChenTsungYu"],
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 20,
            pagerDirection: "last",
            
            
            enableHotKey: true,
            
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="../../../../../../img/avatar.png" alt="Tsung Yu Chen"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Tsung Yu Chen</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Taiwan</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="../../../../../../archives"><p class="title">109</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="../../../../../../categories"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="../../../../../../tags"><p class="title">49</p></a></div></div></nav><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/ChenTsungYu"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://www.facebook.com/zong.y.r/"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/in/tom-chen-1012/"><i class="fab fa-linkedin-in"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#前言"><span class="level-left"><span class="level-item">1</span><span class="level-item">前言</span></span></a></li><li><a class="level is-mobile" href="#什麼是Terraform？"><span class="level-left"><span class="level-item">2</span><span class="level-item">什麼是Terraform？</span></span></a></li><li><a class="level is-mobile" href="#Hands-On-Lab"><span class="level-left"><span class="level-item">3</span><span class="level-item">Hands On Lab</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#安裝"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">安裝</span></span></a></li><li><a class="level is-mobile" href="#查看版本"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">查看版本</span></span></a></li><li><a class="level is-mobile" href="#初始化Provider"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">初始化Provider</span></span></a></li><li><a class="level is-mobile" href="#配置Provider"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">配置Provider</span></span></a></li><li><a class="level is-mobile" href="#查看當前目錄結構"><span class="level-left"><span class="level-item">3.5</span><span class="level-item">查看當前目錄結構</span></span></a></li><li><a class="level is-mobile" href="#下載並匯出-Access-Key"><span class="level-left"><span class="level-item">3.6</span><span class="level-item">下載並匯出 Access Key</span></span></a></li><li><a class="level is-mobile" href="#建立S3"><span class="level-left"><span class="level-item">3.7</span><span class="level-item">建立S3</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#配置resource"><span class="level-left"><span class="level-item">3.7.1</span><span class="level-item">配置resource</span></span></a></li><li><a class="level is-mobile" href="#查看Terraform異動"><span class="level-left"><span class="level-item">3.7.2</span><span class="level-item">查看Terraform異動</span></span></a></li><li><a class="level is-mobile" href="#執行-x2F-創建"><span class="level-left"><span class="level-item">3.7.3</span><span class="level-item">執行/創建</span></span></a></li><li><a class="level is-mobile" href="#查看狀態-state"><span class="level-left"><span class="level-item">3.7.4</span><span class="level-item">查看狀態(state)</span></span></a></li><li><a class="level is-mobile" href="#異動"><span class="level-left"><span class="level-item">3.7.5</span><span class="level-item">異動</span></span></a></li><li><a class="level is-mobile" href="#啟動Versioning"><span class="level-left"><span class="level-item">3.7.6</span><span class="level-item">啟動Versioning</span></span></a></li><li><a class="level is-mobile" href="#刪除"><span class="level-left"><span class="level-item">3.7.7</span><span class="level-item">刪除</span></span></a></li></ul></li><li><a class="level is-mobile" href="#terraform-console"><span class="level-left"><span class="level-item">3.8</span><span class="level-item">terraform console</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#實作"><span class="level-left"><span class="level-item">3.8.1</span><span class="level-item">實作</span></span></a></li><li><a class="level is-mobile" href="#退出console"><span class="level-left"><span class="level-item">3.8.2</span><span class="level-item">退出console</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Output-查看輸出訊息"><span class="level-left"><span class="level-item">3.9</span><span class="level-item">Output 查看輸出訊息</span></span></a></li><li><a class="level is-mobile" href="#操作IAM"><span class="level-left"><span class="level-item">3.10</span><span class="level-item">操作IAM</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#更新IAM-User-name"><span class="level-left"><span class="level-item">3.10.1</span><span class="level-item">更新IAM User name</span></span></a></li><li><a class="level is-mobile" href="#建立多個IAM-User"><span class="level-left"><span class="level-item">3.10.2</span><span class="level-item">建立多個IAM User</span></span></a></li></ul></li><li><a class="level is-mobile" href="#補充一些較常用的指令"><span class="level-left"><span class="level-item">3.11</span><span class="level-item">補充一些較常用的指令</span></span></a></li></ul></li><li><a class="level is-mobile" href="#參閱"><span class="level-left"><span class="level-item">4</span><span class="level-item">參閱</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="../../../../../../js/toc.js" defer></script></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-11-27T08:00:19.787Z">2022/11/27</time></p><p class="title"><a href="../../../../../../2022/11/27/DevOps/CICD/GitHub%20Action%20OIDC/">[Github Action] 整合 AWS OIDC 進行 CI/CD 安全強化</a></p><p class="categories"><a href="../../../../../../categories/DevOps/">DevOps</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-06-29T05:23:10.000Z">2022/06/29</time></p><p class="title"><a href="../../../../../../2022/06/29/Database/Index/">[Postgres] 資料庫的索引(Index)</a></p><p class="categories"><a href="../../../../../../categories/Backend/">Backend</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-06-20T05:23:10.000Z">2022/06/20</time></p><p class="title"><a href="../../../../../../2022/06/20/Database/%E8%B3%87%E6%96%99%E5%BA%AB%E5%A6%82%E4%BD%95%E5%AD%98%E6%94%BE%E8%B3%87%E6%96%99/">[Postgres] 資料庫裡的儲存概念</a></p><p class="categories"><a href="../../../../../../categories/Backend/">Backend</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-01-15T05:23:10.000Z">2022/01/15</time></p><p class="title"><a href="../../../../../../2022/01/15/Database/Redis/%5BBackend%5D%20%E6%8F%90%E9%AB%98%20Redis%20%E5%9F%B7%E8%A1%8C%E6%95%88%E7%8E%87%E7%9A%84%E6%96%B9%E6%B3%95%20-%20Pipeline/">[Redis] 提高 Redis 執行效率的方法 - Pipeline</a></p><p class="categories"><a href="../../../../../../categories/Backend/">Backend</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-01-11T05:23:10.000Z">2022/01/11</time></p><p class="title"><a href="../../../../../../2022/01/11/Database/Redis/%5BBackend%5D%20Redis%20-%20Transction/">[Redis] Redis - Transaction</a></p><p class="categories"><a href="../../../../../../categories/Backend/">Backend</a></p></div></article></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="../../../../../../index.html"><img class="logo-img" src="../../../../../../img/dragon_blue.png" alt="Tom&#039;s Blog" height="28"><img class="logo-img-dark" src="../../../../../../img/dragon_red.png" alt="Tom&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2022 Tsung Yu Chen</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ChenTsungYu"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" async></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="../../../../../../js/column.js"></script><script src="../../../../../../js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="../../../../../../js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="../../../../../../js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="../../../../../../js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"../../../../../../content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script><script type="text/javascript" src="/js/imaegoo/universe.js"></script></body></html>